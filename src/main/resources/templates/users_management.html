<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <title>Управление пользователями</title>

    <script>
        function hideButtonToggle() {
            const button = document.getElementById("collapseButton")
            button.disabled = !button.disabled;
            if (button.disabled) {
                button.style.opacity = 0;
            } else {
                button.style.opacity = 1;
            }
        }
        
        var roles_index_sequence = 0;

        function addRole() {
            const button = document.getElementById("add_button");

            let container = document.createElement('div');
            container.classList.add('hstack');
            container.classList.add('p-0');
            container.classList.add('list-group-item');

            let inp = document.createElement('input');
            inp.placeholder = 'роль...';
            inp.name = 'roles';
            inp.classList.add('w-100');
            inp.classList.add('px-3');
            inp.classList.add('form-control');
            inp.classList.add('form-control-plaintext');
            inp.id = "role_row_" + roles_index_sequence;

            let x_but = document.createElement('button');
            x_but.textContent = 'X';
            x_but.classList.add('btn');
            x_but.classList.add('btn-outline-danger');
            x_but.classList.add('rounded-0');
            x_but.classList.add('border-0');
            x_but.classList.add('border-start');
            x_but.classList.add('input-group-text');
            x_but.type = "button";
            x_but.id = "role_button_" + roles_index_sequence;

            x_but.onclick = (_) => { container.remove() }

            roles_index_sequence++;

            container.append(inp);
            container.append(x_but);
            button.before(container);
        }
    </script>
</head>

<body>
    <div th:insert="~{general :: header(false, null)}"></div>

    <div class="container position-fixed h-100 start-50 translate-middle-x z-n1" style="background-color: aliceblue;"></div>

    <div class="container p-5">
        <h1 class="text-center m-5">Управление пользователями</h1>

        <table class="table my-5">
            <thead>
                <tr style="background-color: rgb(30, 48, 100);">
                    <th style="background: transparent; color: white;" scope="col">Никнейм</th>
                    <th style="background: transparent; color: white;" scope="col">Зарегистрирован</th>
                    <th style="background: transparent; color: white;" scope="col">Последнее сообщение</th>
                    <th style="background: transparent; color: white;" scope="col">Количество сообщений</th>
                </tr>
            </thead>
            <tbody>
                <input type="hidden" name="sessionId" th:value="${session_id}">
                <tr th:each="user, iter : ${users_manager.getAll(user_class)}">
                    <input type="hidden" name="users" th:value="${user.id}">
                    <input type="hidden" name="oldStats" th:value="${user.bannedGlobal}">

                    <td>
                        <a th:text="${user.nickname}" href="#" th:id="|user_link_${iter.index}|"
                            th:href="|/profile?user=${user.id}&session=${session_id}|">Никнейм</a>
                    </td>
                    <td th:text="${user.registrationDate}">
                        xx:xx:xxxx
                    </td>
                    <td th:text="${user.createdMessages.size() == 0} ? '-' : ${user.createdMessages[0].creationTime}">
                        xx:xx:xxxx
                    </td>
                    <td th:text="${user.createdMessages.size()}">
                        xxx
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="hstack">
            <button class="btn btn-success m-3" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"
                id="collapseButton" onclick="hideButtonToggle()">
                + создать пользователя
            </button>
        </div>
        <div class="collapse" id="collapseExample">
            <form class="vstack gap-3" method="post" action="/create_user" th:object="${create_user_form}">
                <input type="hidden" name="sessionId" th:value="${session_id}">
                <div class="hstack gap-2">
                    <div class="vstack gap-1">
                        <div class="input-group align-content-center w-100">
                            <label class="input-group-text text-center" style="min-width: 15%;">Никнейм:</label>
                            <input type="text" class="form-control" th:field="*{nick}" id="new_user_nick">
                        </div>
                        <div class="input-group w-100">
                            <label class="input-group-text text-center" style="min-width: 15%;">Логин:</label>
                            <input type="email" class="form-control" th:field="*{login}" id="new_user_login">
                        </div>
                        <div class="input-group w-100">
                            <label class="input-group-text text-center" style="min-width: 15%;">Пароль:</label>
                            <input type="password" class="form-control" th:field="*{pass}" id="new_user_password">
                        </div>
                    </div>

                    <div class="list-group rounded-0 w-25" id="roles">
                        <label for="roles" class="list-group-item bg-dark text-white text-center">
                            РОЛИ
                        </label>
                        <div class="list-group-item list-group-item-dark" id="add_button">
                            <a href="#" class="text-decoration-none text-dark" id="add_role_link" onclick="addRole()">+
                                добавить</a>
                        </div>
                    </div>
                </div>
                <div class="hstack gap-3">
                    <button class="btn btn-outline-danger" type="reset" data-bs-toggle="collapse" id="new_user_abort"
                        data-bs-target="#collapseExample" onclick="hideButtonToggle()">Отменить</button>
                    <button class="btn btn-success" type="submit" data-bsя-toggle="collapse" id="new_user_create"
                        data-bs-target="#collapseExample" onclick="hideButtontoggle()">Создать</button>
                </div>
            </form>
        </div>

    </div>
    </div>
</body>

</html>